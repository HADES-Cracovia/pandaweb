<?xml version="1.0"  encoding="utf-8" ?>
<TrbNetSetup xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xsi:noNamespaceSchemaLocation="../schema/TrbNetSetup.xsd"
             creator="Andreas Neiser"
             date="2013-06-30T16:11:56"
             version="0.1"
             >
  <!-- The order of the trb elements is respected and their content is
       evaluated after each one (if they specify a value). This is important if the resulting
       changes to the TrbNet must happen in a certain way. -->

  <!-- also note the different uses of the address attribute:
       sometimes it's a register address, sometimes a trbnet endpoint
       address, or sometimes it specifies the chain number of the
       external PaDiWa frontend -->

  
  <!-- this specifies the trbaddress from uid's, it can be omitted if
       the TrbNet is already set-up -->
  <uidMap>
    <uid address="0200" endpoint="0">5900000337e29728</uid>
    <uid address="0201" endpoint="1">cf00000337e29e28</uid>
    <uid address="0202" endpoint="2">ad00000338175028</uid>
    <uid address="0203" endpoint="3">0e00000338174b28</uid>
    <uid address="8000" endpoint="5">4400000338174628</uid>
  </uidMap>

  <!-- we configure the trb endpoint with address 0x8000 -->
  <trb address="8000">
    <broadcast address="fffe" />
    <broadcast address="ff7f" />
    <broadcast address="ff7e" />
    <broadcast address="fe35" />
    
    <entity ref="TrbNet" />

    <!-- it has a TDC (at default register address) -->
    <entity ref="TDC">
      <!-- this way we modify the number of channels to 5. This works
           since group/register/memory/fifo have unique names. It
           might be that there are several places where one should
           change the "repeat" to get a consistent entity model, but
           how does one know that programmitcally??? -->
      <register name="Channel" repeat="5" />
    </entity>

    <!-- and it has a CTS -->
    <entity ref="CTS" />
  </trb>


  <trb address="0200">
    <broadcast address="ff48" />

    <!-- Standard TrbNet enpoint with standard 65ch TDC... -->
    <entity ref="TrbNet" />
    <entity ref="TDC" />
    <!-- ...but also some "external" PaDiWa frontends connected at
         chain 0 and 2. The fronend has some more registers which can
         be accessed via SPI. The idea is that there's also a
         PaDiWa.pm in the database which handles this access, usually
         via conventional TrbNet registers
         -->
    <external ref="PaDiWa" address="0000" />
    <external ref="PaDiWa" address="0002" />
  </trb>


  <!-- An example how to execute a setting. In general, the entities
       are identified by their type and address (if specified) -->
  <trb address="0200">
    <broadcast address="ff48" />

    <entity ref="TDC">
      <!-- this field is a bitmask, so there's a converter to easily
           set single bits -->
      <field name="ChannelEnable">
        0-15 => 1, <!-- enables channels 0-15 -->
        34 => 1, <!-- enables channel 34 -->
      </field>
    </entity>
  </trb>


  <trb address="0200">
    <broadcast address="ff48" />
    <entity ref="TDC">
      <!-- this field is a bitmask, so there's a converter to easily
           set single bits -->
      <field name="ReadoutFSM">
        <enumItem value="0">Bla</enumItem>
        0-15 => 1, <!-- enables channels 0-15 -->
        34 => 5, <!-- enables channel 34 -->
      </field>
    </entity>
  </trb>
  
  
  
  
</TrbNetSetup>
